---
title: "p8105_hw6_at3583"
author: "Alexandria D.Taylor,"
date: "`r format(Sys.Date())`"
output: github_document
---
```{r markdown}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)

library(tidyverse)
library(janitor)
library(broom)
library(purrr)
library(modelr)       
library(p8105.datasets) 

# Global colors + theme for plots
primary_color <- "steelblue3"
accent_color  <- "darkorange2"

theme_set(
  theme_minimal(base_size = 12) +
    theme(
      plot.title = element_text(face = "bold"),
      legend.position = "bottom"
    )
)
```

# Problem 1. Homicides and Logistic Regression

```{r}
# Load and Clean Homicide data from Washington Post 
homicide_df <- read_csv(
  "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"
) |>
  clean_names()

# Clean + filter for analysis
homicide_city <- homicide_df |>
  mutate(
    city_state = str_c(city, ", ", state),
    # binary outcome: 1 = solved, 0 = not solved
    solved = case_when(
      disposition == "Closed by arrest" ~ 1,
      disposition %in% c("Closed without arrest", "Open/No arrest") ~ 0,
      TRUE ~ NA_real_
    ),
    victim_age = as.numeric(victim_age)
  ) |>
  # drop cities with missing race or bad entry
  filter(
    !(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")),
    victim_race %in% c("White", "Black")
  ) |>
  drop_na(solved, victim_age, victim_sex, victim_race)
```
Summary: The cleaned dataset contains **`r nrow(homicide_city)`** homicide records across **`r n_distinct(homicide_city$city_state)`` cities**. After excluding cities without recorded race data (Dallas, TX; Phoenix, AZ; Kansas City, MO; Tulsa, AL) and restricting the analysis to victims who are White or Black, **`r nrow(homicide_city)`** cases remain. Victim age is a numeric variable, with **`r sum(is.na(homicide_city$victim_age))`** entries originally recorded as non-numeric in the raw dataset and recorded as missing during cleaning.

# Baltimore, MD â€“ logistic regression + adjusted OR

```{r}
baltimore_df <- homicide_city |>
  filter(city_state == "Baltimore, MD")

baltimore_fit <- glm(
  solved ~ victim_age + victim_sex + victim_race,
  data = baltimore_df,
  family = binomial()
)

baltimore_or <- baltimore_fit |>
  tidy(exponentiate = TRUE, conf.int = TRUE) |>
  filter(term == "victim_sexMale")

baltimore_or
```

